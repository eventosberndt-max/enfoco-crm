<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enfoco CRM</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=IBM+Plex+Mono:wght@400;500&family=Syne:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0b;
  --s1: #111113;
  --s2: #18181b;
  --s3: #222226;
  --border: #2e2e34;
  --gold: #f0c040;
  --gold2: #c89a20;
  --goldbg: #1a1500;
  --green: #3dba7a;
  --greenbg: #071812;
  --red: #e05555;
  --redbg: #1a0707;
  --orange: #e88c30;
  --orangebg: #1a0e00;
  --blue: #4d8fd4;
  --bluebg: #070f1a;
  --text: #e8e4dc;
  --muted: #6b6860;
  --muted2: #4a4845;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:'Syne',sans-serif;min-height:100vh;overflow-x:hidden}

/* GRAIN */
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");pointer-events:none;z-index:999;opacity:.6}

/* LAYOUT */
.shell{display:grid;grid-template-columns:220px 1fr;min-height:100vh}

/* SIDEBAR */
.sidebar{background:var(--s1);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:0;position:sticky;top:0;height:100vh;overflow-y:auto}
.logo-block{padding:28px 20px 24px;border-bottom:1px solid var(--border)}
.logo-name{font-family:'Playfair Display',serif;font-size:18px;color:var(--gold);letter-spacing:-.3px}
.logo-tag{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-top:3px}
.nav{padding:16px 12px;flex:1;display:flex;flex-direction:column;gap:2px}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:7px;cursor:pointer;color:var(--muted);font-size:13px;font-weight:500;transition:all .15s;border:none;background:none;width:100%;text-align:left}
.nav-item:hover{background:var(--s2);color:var(--text)}
.nav-item.active{background:rgba(240,192,64,.1);color:var(--gold);border-left:2px solid var(--gold)}
.nav-item .ni{font-size:15px;width:22px;text-align:center}
.nav-sep{height:1px;background:var(--border);margin:10px 0}
.sidebar-footer{padding:16px 20px;border-top:1px solid var(--border)}
.api-indicator{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);display:flex;align-items:center;gap:6px}
.api-dot{width:6px;height:6px;border-radius:50%;background:var(--red)}
.api-dot.ok{background:var(--green)}

/* MAIN */
.main{display:flex;flex-direction:column;min-height:100vh}
.topbar{padding:20px 32px;border-bottom:1px solid var(--border);background:var(--s1);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:10}
.page-title{font-family:'Playfair Display',serif;font-size:22px;color:var(--text)}
.page-title em{color:var(--gold);font-style:italic}
.topbar-actions{display:flex;gap:8px;align-items:center}
.content{padding:28px 32px;flex:1}

/* PANELS */
.panel{display:none;flex-direction:column;gap:20px;animation:fadeIn .2s ease}
.panel.active{display:flex}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

/* CARDS */
.card{background:var(--s1);border:1px solid var(--border);border-radius:12px;overflow:hidden}
.card-header{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:var(--s2)}
.card-title{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1.2px;text-transform:uppercase;display:flex;align-items:center;gap:8px}
.card-title::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--gold)}
.card-body{padding:18px}

/* BOTONES */
.btn{padding:9px 18px;border-radius:8px;font-family:'Syne',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s;border:none;display:inline-flex;align-items:center;gap:7px}
.btn-primary{background:var(--gold);color:#0a0a0b}
.btn-primary:hover{background:#f8d060;transform:translateY(-1px)}
.btn-ghost{background:transparent;border:1px solid var(--border);color:var(--muted)}
.btn-ghost:hover{border-color:var(--muted);color:var(--text)}
.btn-sm{padding:6px 12px;font-size:12px}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}
.btn-green{background:var(--green);color:#0a0a0b}
.btn-green:hover{background:#55d490}

/* INPUTS */
.field{display:flex;flex-direction:column;gap:5px}
.field label{font-size:11px;color:var(--muted);font-weight:600;letter-spacing:.5px}
.field input,.field textarea,.field select{background:var(--s2);border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:8px;font-family:'Syne',sans-serif;font-size:13px;outline:none;transition:border-color .15s;resize:vertical}
.field input::placeholder,.field textarea::placeholder{color:var(--muted2)}
.field input:focus,.field textarea:focus,.field select:focus{border-color:var(--gold)}
.field select option{background:var(--s2)}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.full{grid-column:1/-1}

/* SEMAFORO CHIPS */
.chip{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;font-family:'IBM Plex Mono',monospace}
.chip-red{background:var(--redbg);color:var(--red);border:1px solid rgba(224,85,85,.3)}
.chip-orange{background:var(--orangebg);color:var(--orange);border:1px solid rgba(232,140,48,.3)}
.chip-green{background:var(--greenbg);color:var(--green);border:1px solid rgba(61,186,122,.3)}
.chip-blue{background:var(--bluebg);color:var(--blue);border:1px solid rgba(77,143,212,.3)}
.chip-gold{background:var(--goldbg);color:var(--gold);border:1px solid rgba(240,192,64,.3)}
.chip-muted{background:var(--s3);color:var(--muted);border:1px solid var(--border)}

/* ESTADOS */
.estado-chip{padding:3px 9px;border-radius:4px;font-size:10px;font-family:'IBM Plex Mono',monospace;font-weight:500}
.e-nuevo{background:rgba(77,143,212,.15);color:var(--blue)}
.e-enviado{background:rgba(240,192,64,.15);color:var(--gold)}
.e-tratativa{background:rgba(61,186,122,.15);color:var(--green)}
.e-pausa{background:var(--s3);color:var(--muted)}

/* TABLA LEADS */
.leads-table{width:100%;border-collapse:collapse}
.leads-table th{background:var(--s2);padding:10px 14px;text-align:left;font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;border-bottom:1px solid var(--border)}
.leads-table td{padding:12px 14px;border-bottom:1px solid var(--border);font-size:13px;vertical-align:top}
.leads-table tr:last-child td{border-bottom:none}
.leads-table tr:hover td{background:rgba(255,255,255,.02)}
.lead-empresa{font-weight:700;color:var(--text);margin-bottom:3px;font-size:13px}
.lead-contacto{color:var(--muted);font-size:12px}
.lead-contacto span{color:var(--text)}
.contact-icons{display:flex;gap:6px;margin-top:6px}
.contact-icon{width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:11px;cursor:pointer;transition:transform .1s}
.contact-icon:hover{transform:scale(1.1)}
.ci-wpp{background:rgba(61,186,122,.2);border:1px solid rgba(61,186,122,.3)}
.ci-mail{background:rgba(240,192,64,.15);border:1px solid rgba(240,192,64,.3)}
.ci-li{background:rgba(77,143,212,.15);border:1px solid rgba(77,143,212,.3)}
.paso-text{font-size:12px;color:var(--muted);max-width:260px;line-height:1.5}
.prox-fecha{font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--muted);margin-top:4px}

/* HOY PANEL */
.hoy-header{display:flex;align-items:center;gap:12px;margin-bottom:4px}
.hoy-date{font-family:'IBM Plex Mono',monospace;font-size:12px;color:var(--muted)}
.hoy-count{font-family:'IBM Plex Mono',monospace;font-size:11px;background:var(--goldbg);color:var(--gold);padding:3px 10px;border-radius:20px;border:1px solid rgba(240,192,64,.3)}
.urgency-section{margin-bottom:20px}
.urgency-label{font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;padding:8px 0 10px;display:flex;align-items:center;gap:8px}
.urgency-label::after{content:'';flex:1;height:1px;background:var(--border)}
.lead-card{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:10px;display:grid;grid-template-columns:1fr auto;gap:12px;align-items:start;cursor:pointer;transition:border-color .15s}
.lead-card:hover{border-color:var(--gold)}
.lead-card.urgent{border-left:3px solid var(--red)}
.lead-card.today{border-left:3px solid var(--orange)}
.lead-card.ok{border-left:3px solid var(--muted2)}
.lc-empresa{font-weight:700;font-size:14px;margin-bottom:3px}
.lc-contacto{font-size:12px;color:var(--muted);margin-bottom:8px}
.lc-paso{font-size:12px;color:var(--muted);line-height:1.5;margin-bottom:8px}
.lc-medio{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted)}
.lc-actions{display:flex;flex-direction:column;gap:6px;align-items:flex-end}

/* AI RESULT */
.ai-result{background:var(--s2);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-top:16px}
.ai-result-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:var(--greenbg)}
.ai-result-label{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--green);letter-spacing:1px;display:flex;align-items:center;gap:8px}
.ai-pulse{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 1.4s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.ai-body{padding:16px;font-size:13px;line-height:1.8;white-space:pre-wrap;color:var(--text)}
.copy-btn{background:var(--s3);border:1px solid var(--border);color:var(--muted);padding:5px 10px;border-radius:6px;cursor:pointer;font-size:11px;font-family:'IBM Plex Mono',monospace;transition:all .15s}
.copy-btn:hover{border-color:var(--gold);color:var(--gold)}

/* LOADER */
.loader{display:none;align-items:center;gap:10px;padding:16px;color:var(--muted);font-size:13px}
.loader.on{display:flex}
.dots span{display:inline-block;width:5px;height:5px;border-radius:50%;background:var(--gold);animation:bounce 1.1s infinite;margin:0 2px}
.dots span:nth-child(2){animation-delay:.2s}
.dots span:nth-child(3){animation-delay:.4s}
@keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.3}40%{transform:translateY(-6px);opacity:1}}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:100;display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.open{display:flex}
.modal{background:var(--s1);border:1px solid var(--border);border-radius:14px;width:100%;max-width:580px;max-height:90vh;overflow-y:auto}
.modal-header{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-title{font-family:'Playfair Display',serif;font-size:18px;color:var(--text)}
.modal-close{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;padding:4px}
.modal-close:hover{color:var(--text)}
.modal-body{padding:24px;display:flex;flex-direction:column;gap:14px}
.modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:8px}

/* TABS dentro de modal */
.tab-row{display:flex;gap:4px;background:var(--s2);padding:4px;border-radius:8px}
.tab-btn{flex:1;padding:8px;border:none;background:none;color:var(--muted);font-family:'Syne',sans-serif;font-size:12px;font-weight:600;cursor:pointer;border-radius:6px;transition:all .15s}
.tab-btn.active{background:var(--s3);color:var(--text)}
.tab-content{display:none}
.tab-content.active{display:flex;flex-direction:column;gap:12px}

/* SETUP */
.setup-overlay{position:fixed;inset:0;background:var(--bg);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px}
.setup-box{background:var(--s1);border:1px solid var(--border);border-radius:16px;padding:40px;max-width:440px;width:100%;text-align:center}
.setup-title{font-family:'Playfair Display',serif;font-size:28px;color:var(--gold);margin-bottom:8px}
.setup-sub{color:var(--muted);font-size:14px;line-height:1.6;margin-bottom:28px}
.setup-steps{text-align:left;display:flex;flex-direction:column;gap:14px;margin-bottom:28px}
.setup-step{display:flex;gap:12px;align-items:flex-start}
.step-num{width:24px;height:24px;border-radius:50%;background:var(--goldbg);border:1px solid rgba(240,192,64,.3);color:var(--gold);font-size:11px;font-family:'IBM Plex Mono',monospace;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.step-text{font-size:13px;color:var(--muted);line-height:1.5;padding-top:3px}
.step-text strong{color:var(--text)}
.setup-input{background:var(--s2);border:1px solid var(--border);color:var(--text);padding:11px 14px;border-radius:8px;font-family:'IBM Plex Mono',monospace;font-size:12px;width:100%;outline:none;margin-bottom:10px}
.setup-input:focus{border-color:var(--gold)}

/* NOTIFY */
.notify{position:fixed;bottom:24px;right:24px;background:var(--s2);border:1px solid var(--border);border-radius:10px;padding:12px 18px;font-size:13px;z-index:300;transform:translateY(100px);opacity:0;transition:all .3s}
.notify.show{transform:translateY(0);opacity:1}
.notify.success{border-color:rgba(61,186,122,.4);color:var(--green)}
.notify.error{border-color:rgba(224,85,85,.4);color:var(--red)}

/* SCROLLBAR */
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:10px}

/* EMPTY */
.empty{text-align:center;padding:48px 20px;color:var(--muted)}
.empty-icon{font-size:36px;margin-bottom:12px}
.empty-msg{font-size:14px}

.refresh-btn{font-family:'IBM Plex Mono',monospace;font-size:10px}
.canal-selector{display:flex;gap:6px}
.canal-opt{padding:7px 14px;border-radius:7px;border:1px solid var(--border);background:var(--s2);color:var(--muted);font-size:12px;font-family:'Syne',sans-serif;font-weight:600;cursor:pointer;transition:all .15s}
.canal-opt:hover{border-color:var(--muted);color:var(--text)}
.canal-opt.active.wpp{border-color:var(--green);color:var(--green);background:var(--greenbg)}
.canal-opt.active.mail{border-color:var(--gold);color:var(--gold);background:var(--goldbg)}
.canal-opt.active.li{border-color:var(--blue);color:var(--blue);background:var(--bluebg)}
</style>
</head>
<body>

<!-- SETUP -->
<div class="setup-overlay" id="setupOverlay">
  <div class="setup-box">
    <div class="setup-title">Enfoco CRM</div>
    <div class="setup-sub">Configuraci√≥n inicial ‚Äî solo una vez</div>
    <div class="setup-steps">
      <div class="setup-step">
        <div class="step-num">1</div>
        <div class="step-text">Ingres√° tu <strong>API Key de Anthropic</strong> (conseguila en console.anthropic.com ‚Äî empieza con sk-ant-)</div>
      </div>
      <div class="setup-step">
        <div class="step-num">2</div>
        <div class="step-text">Tu <strong>Google Sheet ya est√° configurado</strong> ‚Äî la app lo lee autom√°ticamente</div>
      </div>
    </div>
    <input class="setup-input" type="password" id="setupKey" placeholder="sk-ant-api03-..." />
    <button class="btn btn-primary" style="width:100%;justify-content:center" onclick="saveSetup()">
      Comenzar ‚Üí
    </button>
  </div>
</div>

<!-- MAIN SHELL -->
<div class="shell" id="mainShell" style="display:none">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo-block">
      <div class="logo-name">Enfoco Films</div>
      <div class="logo-tag">Asistente Comercial</div>
    </div>
    <nav class="nav">
      <button class="nav-item active" onclick="showPanel('hoy',this)">
        <span class="ni">üéØ</span> Plan del D√≠a
      </button>
      <button class="nav-item" onclick="showPanel('leads',this)">
        <span class="ni">üíº</span> Leads 2026
      </button>
      <button class="nav-item" onclick="showPanel('vistage',this)">
        <span class="ni">üèÜ</span> Vistage 2026
      </button>
      <div class="nav-sep"></div>
      <button class="nav-item" onclick="showPanel('nuevo_vistage',this)">
        <span class="ni">‚ûï</span> Cargar Vistage
      </button>
      <button class="nav-item" onclick="showPanel('respuesta',this)">
        <span class="ni">‚Ü©Ô∏è</span> Registrar Respuesta
      </button>
    </nav>
    <div class="sidebar-footer">
      <div class="api-indicator">
        <div class="api-dot ok" id="apiDot"></div>
        <span id="apiStatus">API conectada</span>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <div class="page-title" id="pageTitle">Plan del <em>D√≠a</em></div>
      <div class="topbar-actions">
        <button class="btn btn-ghost btn-sm refresh-btn" onclick="loadSheetData()">‚ü≥ Actualizar</button>
      </div>
    </div>

    <div class="content">

      <!-- ‚ïê‚ïê PANEL: HOY ‚ïê‚ïê -->
      <div class="panel active" id="panel-hoy">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div class="hoy-header">
            <div class="hoy-date" id="todayDate"></div>
            <div class="hoy-count" id="urgentCount">cargando...</div>
          </div>
          <button class="btn btn-primary btn-sm" onclick="generarPlanDia()">‚ú® Generar Plan IA</button>
        </div>

        <div class="loader" id="loaderHoy"><div class="dots"><span></span><span></span><span></span></div> Analizando leads...</div>
        <div class="ai-result" id="planResult" style="display:none">
          <div class="ai-result-header">
            <div class="ai-result-label"><div class="ai-pulse"></div>Plan generado por IA</div>
            <button class="copy-btn" onclick="copyText('planBody')">üìã Copiar</button>
          </div>
          <div class="ai-body" id="planBody"></div>
        </div>

        <div id="hoyContainer"></div>
      </div>

      <!-- ‚ïê‚ïê PANEL: LEADS ‚ïê‚ïê -->
      <div class="panel" id="panel-leads">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Leads 2026 ‚Äî Con inter√©s confirmado</div>
            <button class="btn btn-primary btn-sm" onclick="openModal('modalLead')">+ Nuevo Lead</button>
          </div>
          <div style="overflow-x:auto">
            <table class="leads-table" id="leadsTable">
              <thead>
                <tr>
                  <th>Empresa / Contacto</th>
                  <th>Contacto directo</th>
                  <th>Estado</th>
                  <th>Sem√°foro</th>
                  <th>Pr√≥ximo paso</th>
                  <th>Acci√≥n</th>
                </tr>
              </thead>
              <tbody id="leadsBody">
                <tr><td colspan="6" style="text-align:center;padding:32px;color:var(--muted)">Cargando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê PANEL: VISTAGE ‚ïê‚ïê -->
      <div class="panel" id="panel-vistage">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Vistage 2026 ‚Äî Enviados por LinkedIn</div>
          </div>
          <div style="overflow-x:auto">
            <table class="leads-table" id="vistageTable">
              <thead>
                <tr>
                  <th>Nombre / Compa√±√≠a</th>
                  <th>Rubro</th>
                  <th>Estado</th>
                  <th>√öltimo contacto</th>
                  <th>Acci√≥n</th>
                </tr>
              </thead>
              <tbody id="vistageBody">
                <tr><td colspan="5" style="text-align:center;padding:32px;color:var(--muted)">Cargando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê PANEL: NUEVO VISTAGE ‚ïê‚ïê -->
      <div class="panel" id="panel-nuevo_vistage">
        <div class="card">
          <div class="card-header"><div class="card-title">Cargar desde LinkedIn</div></div>
          <div class="card-body">
            <div class="tab-row" style="margin-bottom:16px">
              <button class="tab-btn active" onclick="switchTab('tab-link',this)">üîó Pegar URL</button>
              <button class="tab-btn" onclick="switchTab('tab-texto',this)">üìù Pegar texto del perfil</button>
            </div>
            <div class="tab-content active" id="tab-link">
              <div class="field">
                <label>URL del perfil de LinkedIn</label>
                <input type="text" id="liUrl" placeholder="https://www.linkedin.com/in/nombre-persona/" />
              </div>
              <div class="field">
                <label>Rubro / Sector (opcional)</label>
                <input type="text" id="liRubro" placeholder="Ej: Alimentos, Automotriz, Agencia..." />
              </div>
              <button class="btn btn-primary" style="margin-top:8px" onclick="analizarLinkedIn()">ü§ñ Analizar y cargar</button>
            </div>
            <div class="tab-content" id="tab-texto">
              <div class="field">
                <label>Peg√° el texto copiado del perfil de LinkedIn (o descripci√≥n)</label>
                <textarea id="liTexto" rows="6" placeholder="Peg√° ac√° el nombre, cargo, empresa, descripci√≥n... cualquier info del perfil"></textarea>
              </div>
              <div class="field">
                <label>Rubro / Sector (opcional)</label>
                <input type="text" id="liRubro2" placeholder="Ej: Alimentos, Automotriz, Agencia..." />
              </div>
              <button class="btn btn-primary" style="margin-top:8px" onclick="analizarTextoLinkedIn()">ü§ñ Analizar y cargar</button>
            </div>

            <div class="loader" id="loaderLi" style="margin-top:12px"><div class="dots"><span></span><span></span><span></span></div> Analizando perfil...</div>
            <div class="ai-result" id="liResult" style="display:none;margin-top:12px">
              <div class="ai-result-header">
                <div class="ai-result-label"><div class="ai-pulse"></div>Perfil analizado</div>
              </div>
              <div class="ai-body" id="liBody"></div>
            </div>
            <div id="liFormContainer" style="display:none;margin-top:16px">
              <div style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:12px">Confirm√° los datos antes de guardar</div>
              <div class="form-grid">
                <div class="field"><label>Nombre</label><input type="text" id="vi_nombre" /></div>
                <div class="field"><label>Compa√±√≠a</label><input type="text" id="vi_company" /></div>
                <div class="field"><label>Cargo</label><input type="text" id="vi_cargo" /></div>
                <div class="field"><label>Rubro</label><input type="text" id="vi_rubro" /></div>
                <div class="field"><label>LinkedIn URL</label><input type="text" id="vi_url" /></div>
                <div class="field"><label>Provincia</label><input type="text" id="vi_prov" placeholder="Ej: Buenos Aires" /></div>
                <div class="field full"><label>Primer mensaje sugerido</label><textarea id="vi_msg" rows="4"></textarea></div>
              </div>
              <button class="btn btn-green" style="margin-top:8px" onclick="guardarVistage()">‚úì Guardar en Vistage 2026</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê PANEL: RESPUESTA ‚ïê‚ïê -->
      <div class="panel" id="panel-respuesta">
        <div class="card">
          <div class="card-header"><div class="card-title">Registrar respuesta de un lead</div></div>
          <div class="card-body" style="display:flex;flex-direction:column;gap:14px">
            <div class="field">
              <label>¬øQui√©n respondi√≥?</label>
              <select id="respLead">
                <option value="">‚Äî Seleccion√° el lead ‚Äî</option>
              </select>
            </div>
            <div class="field">
              <label>¬øDesde d√≥nde ven√≠a? (hoja de origen)</label>
              <select id="respOrigen">
                <option value="vistage">Vistage 2026</option>
                <option value="leads">Ya estaba en Leads 2026</option>
              </select>
            </div>
            <div class="field">
              <label>Peg√° la respuesta que te mandaron</label>
              <textarea id="respTexto" rows="5" placeholder="Copi√° y peg√° el mensaje de LinkedIn, WhatsApp o email..."></textarea>
            </div>
            <div class="field">
              <label>Datos de contacto que ten√©s (si los conseguiste)</label>
              <div class="form-grid">
                <div class="field"><label>WhatsApp</label><input type="text" id="respWpp" placeholder="+54 11 ..." /></div>
                <div class="field"><label>Email</label><input type="text" id="respMail" placeholder="email@empresa.com" /></div>
              </div>
            </div>
            <button class="btn btn-primary" onclick="procesarRespuesta()">ü§ñ Analizar y generar pr√≥ximo paso</button>

            <div class="loader" id="loaderResp"><div class="dots"><span></span><span></span><span></span></div> Analizando conversaci√≥n...</div>

            <div class="ai-result" id="respResult" style="display:none">
              <div class="ai-result-header">
                <div class="ai-result-label"><div class="ai-pulse"></div>An√°lisis y pr√≥ximo paso</div>
                <button class="copy-btn" onclick="copyText('respBody')">üìã Copiar mensaje</button>
              </div>
              <div class="ai-body" id="respBody"></div>
            </div>

            <div id="respAccion" style="display:none">
              <div style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px;margin-bottom:10px">UNA VEZ QUE MANDASTE EL MENSAJE</div>
              <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
                <span style="font-size:13px;color:var(--muted)">Pr√≥ximo seguimiento en:</span>
                <select id="respDias" style="background:var(--s2);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;font-family:'Syne',sans-serif;font-size:13px;outline:none">
                  <option value="3">3 d√≠as</option>
                  <option value="5" selected>5 d√≠as</option>
                  <option value="7">7 d√≠as</option>
                  <option value="14">14 d√≠as</option>
                  <option value="30">30 d√≠as</option>
                </select>
                <button class="btn btn-green btn-sm" onclick="confirmarEnvio()">‚úì Mensaje enviado ‚Äî actualizar fecha</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<!-- MODAL: NUEVO LEAD MANUAL -->
<div class="modal-overlay" id="modalLead">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Nuevo Lead</div>
      <button class="modal-close" onclick="closeModal('modalLead')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="field"><label>Empresa</label><input type="text" id="nl_empresa" /></div>
        <div class="field"><label>Contacto</label><input type="text" id="nl_contacto" /></div>
        <div class="field"><label>Cargo</label><input type="text" id="nl_cargo" /></div>
        <div class="field"><label>Rubro</label><input type="text" id="nl_rubro" /></div>
        <div class="field"><label>WhatsApp</label><input type="text" id="nl_wpp" /></div>
        <div class="field"><label>Email</label><input type="text" id="nl_mail" /></div>
        <div class="field"><label>Origen</label>
          <select id="nl_origen">
            <option>Vistage</option><option>LinkedIn</option><option>Referido</option><option>Expo/Feria</option>
          </select>
        </div>
        <div class="field"><label>Estado inicial</label>
          <select id="nl_estado">
            <option value="1 - Nuevo">1 - Nuevo</option>
            <option value="2 - Enviado">2 - Enviado</option>
          </select>
        </div>
        <div class="field full"><label>Pr√≥ximo paso / Notas</label><textarea id="nl_paso" rows="3"></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalLead')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarLead()">Guardar lead</button>
    </div>
  </div>
</div>

<!-- MODAL: GENERAR MENSAJE PARA UN LEAD -->
<div class="modal-overlay" id="modalMensaje">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalMensajeTitulo">Generar mensaje</div>
      <button class="modal-close" onclick="closeModal('modalMensaje')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="field">
        <label>Canal</label>
        <div class="canal-selector">
          <button class="canal-opt wpp active" onclick="selectCanal('wpp',this)">üí¨ WhatsApp</button>
          <button class="canal-opt li" onclick="selectCanal('li',this)">üíº LinkedIn</button>
          <button class="canal-opt mail" onclick="selectCanal('mail',this)">üìß Email</button>
        </div>
      </div>
      <div class="field">
        <label>Tipo de mensaje</label>
        <select id="msg_tipo">
          <option value="primer contacto fr√≠o">Primer contacto</option>
          <option value="seguimiento ‚Äî no respondi√≥">Seguimiento (no respondi√≥)</option>
          <option value="respuesta a lo que me dijeron">Responder lo recibido</option>
          <option value="propuesta concreta / cierre">Propuesta / Cierre</option>
        </select>
      </div>
      <div class="field">
        <label>Contexto adicional (opcional)</label>
        <textarea id="msg_contexto" rows="3" placeholder="Algo que encontraste en su LinkedIn, lo que te dijeron, una feria pr√≥xima..."></textarea>
      </div>
      <button class="btn btn-primary" style="width:100%;justify-content:center" onclick="generarMensaje()">‚ú® Generar mensaje</button>
      <div class="loader" id="loaderMsg"><div class="dots"><span></span><span></span><span></span></div> Generando...</div>
      <div class="ai-result" id="msgResult" style="display:none">
        <div class="ai-result-header">
          <div class="ai-result-label"><div class="ai-pulse"></div>Mensaje listo</div>
          <button class="copy-btn" onclick="copyText('msgBody')">üìã Copiar</button>
        </div>
        <div class="ai-body" id="msgBody"></div>
      </div>
      <div id="msgAccion" style="display:none;margin-top:12px">
        <div style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:1px;margin-bottom:10px">DESPU√âS DE ENVIAR</div>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <span style="font-size:12px;color:var(--muted)">Pr√≥ximo seguimiento:</span>
          <select id="msgDias" style="background:var(--s2);border:1px solid var(--border);color:var(--text);padding:7px 10px;border-radius:7px;font-family:'Syne',sans-serif;font-size:12px;outline:none">
            <option value="3">3 d√≠as</option>
            <option value="5" selected>5 d√≠as</option>
            <option value="7">7 d√≠as</option>
            <option value="14">14 d√≠as</option>
          </select>
          <button class="btn btn-green btn-sm" onclick="confirmarEnvioMsg()">‚úì Enviado</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- NOTIFY -->
<div class="notify" id="notify"></div>

<script>
// ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SHEET_ID = '1xUoXkb-OIcQmjxuMZTUN2YfB9qtFnv87';
const ENFOCO_CTX = `Sos el asistente comercial de Enfoco Films, productora audiovisual de Buenos Aires.
SERVICIOS: video corporativo/institucional, streaming de eventos, publicidad, fotograf√≠a, animaci√≥n.
DIRECTOR: Dami Guelman, miembro Vistage G-308.
CLIENTES REF: GS1, INTA, Amcor, Essilor Luxottica, BAT, CPACF.
TONO: cercano, directo, argentino, sin protocolo. Hablar de par a par.
CANAL PREFERIDO: WhatsApp. Si no hay n√∫mero ‚Üí LinkedIn con objetivo de conseguir WPP.
REGLAS DE MENSAJES: siempre mencionar Vistage G-308 en primer contacto. M√°x 5 l√≠neas para WPP/LinkedIn. Terminar con UNA sola pregunta.`;

let API_KEY = '';
let sheetData = { leads: [], vistage: [] };
let currentLead = null;
let selectedCanal = 'wpp';
let currentTab = 'tab-link';

// ‚îÄ‚îÄ SETUP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveSetup() {
  const k = document.getElementById('setupKey').value.trim();
  if (!k.startsWith('sk-ant-')) { showNotify('La key debe empezar con sk-ant-', 'error'); return; }
  API_KEY = k;
  localStorage.setItem('ef_key', k);
  document.getElementById('setupOverlay').style.display = 'none';
  document.getElementById('mainShell').style.display = 'grid';
  init();
}

function checkSetup() {
  const k = localStorage.getItem('ef_key');
  if (k) {
    API_KEY = k;
    document.getElementById('setupOverlay').style.display = 'none';
    document.getElementById('mainShell').style.display = 'grid';
    init();
  }
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function init() {
  const now = new Date();
  document.getElementById('todayDate').textContent =
    now.toLocaleDateString('es-AR', { weekday:'long', day:'numeric', month:'long' });
  loadSheetData();
}

// ‚îÄ‚îÄ LEER GOOGLE SHEETS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadSheetData() {
  // URLs p√∫blicas CSV (publicadas en la web desde Google Sheets)
  const LEADS_CSV  = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSROJCqfeSILX3MWmwvpS6dcUKqWqP580naRZu_CjpVijSUSqZfre59Id0TQyyfOQ/pub?output=csv&gid=1488122141';
  const VISTAGE_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSROJCqfeSILX3MWmwvpS6dcUKqWqP580naRZu_CjpVijSUSqZfre59Id0TQyyfOQ/pub?output=csv&gid=530322819';

  try {
    const [leadsResp, vistageResp] = await Promise.all([
      fetch(LEADS_CSV), fetch(VISTAGE_CSV)
    ]);

    if (leadsResp.ok) {
      const csv = await leadsResp.text();
      const rows = parseCSV(csv);
      // Saltar filas de t√≠tulo/headers hasta encontrar datos reales
      sheetData.leads = rows.filter(r => {
        const e = (r[0]||'').trim();
        return e && e !== 'Empresa' && e !== 'üíº  LEADS 2026 ‚Äî Prospectos con inter√©s confirmado' && !e.startsWith('üî•') && !e.startsWith('üíº');
      });
    }

    if (vistageResp.ok) {
      const csv = await vistageResp.text();
      const rows = parseCSV(csv);
      sheetData.vistage = rows.filter(r => {
        const n = (r[2]||'').trim();
        return n && n.length < 60 && n !== 'Nombre' && !n.startsWith('üèÜ');
      });
    }

    renderHoy();
    renderLeads();
    renderVistage();
    populateRespSelect();
    showNotify('Planilla actualizada ‚úì', 'success');
  } catch(e) {
    loadFallbackData();
    showNotify('Modo offline ‚Äî datos locales', 'error');
  }
}

function parseCSV(text) {
  const rows = [];
  const lines = text.split('\n');
  for (const line of lines) {
    const row = [];
    let inQ = false, cur = '';
    for (let i = 0; i < line.length; i++) {
      const c = line[i];
      if (c === '"') { inQ = !inQ; continue; }
      if (c === ',' && !inQ) { row.push(cur.trim()); cur = ''; continue; }
      cur += c;
    }
    row.push(cur.trim());
    rows.push(row);
  }
  return rows;
}

function loadFallbackData() {
  // Datos de la planilla que ya le√≠mos en esta sesi√≥n
  sheetData.leads = [
    ['Dianddi Orax','Axel Dillon','','11-6374-9826','','Vistage','','','2 - Enviado','2026-02-26','üü° Hoy','escribimos por wpp reunion semana de marzo'],
    ['LEFER SRL','Fernando Morreale','','','fernandomorreale@hotmail.com','Vistage','','','2 - Enviado','2026-02-26','üü° Hoy','LE MANDE POR LINKEDIN PARA REUNION'],
    ['Yellow & Co','Vistoria Compagno','','','','Vistage','','','1 - Nuevo','2026-02-26','üü° Hoy','Nos respondio que nos escribe cuando necesite'],
    ['MC Servicios Integrales','Cynthi Othatceguy','','','cynthia@mcservicios.org','Vistage','','','1 - Nuevo','2026-02-26','üü° Hoy','PEDIR REUNION PARA VIERNES POR LINKEDIN'],
    ['AWD Agency','Juan Elliot','','','','Vistage - Agencia','','','1 - Nuevo','2026-02-26','üü° Hoy','PAS: Coordinar por mail una reunion'],
    ['Bien Buenos Aires','Nacho Perez Vidal','','','','Vistage - Agencia','','','1 - Nuevo','2026-02-26','üü° Hoy','PAS: Coordinar por mail una reunion'],
    ['Rotundo Media Group','Macarena Baez','','','','Vistage - Agencia','','','1 - Nuevo','2026-02-26','üü° Hoy','PAS: Hacer seguimiento por Whatapp para reunion'],
    ['TORKY','Juan Ignacio Guajardo','','','torkymobility@gmail.com','Vistage','','','2 - Enviado','2026-03-03','üü¢ Ok','PAS: Le hice el seguimiento, si no responde bajarlo a 0%'],
    ['AUDIO BUENOS AIRES','Leonardo Gaston Nadur','','','lnadur@buenosaires-sa.com.ar','Vistage','','','2 - Enviado','2026-03-03','üü¢ Ok','PAS: Le mande mail personalizado'],
    ['FontanaSisti','Soledad Fontana','','','','Vistage - Agencia','','','6 - Proyecto En Tratativa','2026-03-04','üü¢ Ok','REUNION 4-3-26'],
    ['Siglo XXI Editores','Sofia Miranda','','','','Feria del Libro','','','2 - Enviado','2026-03-02','üü¢ Ok','Marcelo Mingiano Gerente Comercial nos paso el contacto'],
    ['AUTOTRONICA LA PLATA','Diego Suarez','','','','Vistage','','','2 - Enviado','2026-03-02','üü¢ Ok','podcast'],
    ['Reydi de HP SA','Alejandra Pelayes','','','','Vistage','','','2 - Enviado','2026-03-02','üü¢ Ok','Escribirle en Marzo'],
    ['Fidegroup SA','Federico Marini','','','','Vistage - Alimentos','','','1 - Nuevo','2026-03-17','üü¢ Ok','Dijo que ahora no pero mas adelante reunirnos'],
    ['DOLZ','Lujan Belloli','','','','Automechanika','','','3 - En Pausa','2026-04-13','üü¢ Ok','Por el momento no quieren nada'],
    ['SD Direcciones','Eric Prieto','','','','Vistage','','','3 - En Pausa','2026-04-13','üü¢ Ok','Por el momento no quieren nada'],
    ['STARRETT','Aurelio Soares','','','','Podcast Red','','','1 - Nuevo','','','Envie via Linkedin para 3D de Productos'],
    ['INTEGRALIM','Bruno Sechet','','','','Podcast MB','','','1 - Nuevo','','','Proponerle Podcast o Workshops'],
    ['VERALIMENT','Andres Garcia','','','','Podcast MB','','','1 - Nuevo','','','venderle tutorial, proponerle Podcast'],
  ];
  sheetData.vistage = [];
  renderHoy();
  renderLeads();
  renderVistage();
  populateRespSelect();
}

// ‚îÄ‚îÄ RENDER HOY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderHoy() {
  const container = document.getElementById('hoyContainer');
  const leads = sheetData.leads;

  const urgent = leads.filter(r => (r[10]||'').includes('üî¥') || (r[10]||'').toLowerCase().includes('vencido'));
  const today  = leads.filter(r => (r[10]||'').includes('üü°') || (r[10]||'').toLowerCase().includes('hoy'));
  const ok     = leads.filter(r => (r[10]||'').includes('üü¢'));
  const sin    = leads.filter(r => !r[10] || r[10].trim() === '');

  const total = urgent.length + today.length;
  document.getElementById('urgentCount').textContent =
    total > 0 ? `${total} para hoy` : 'Al d√≠a ‚úì';

  let html = '';

  if (urgent.length) {
    html += `<div class="urgency-section">
      <div class="urgency-label" style="color:var(--red)">üî¥ Urgente ‚Äî acci√≥n inmediata</div>`;
    urgent.forEach(r => html += leadCard(r, 'urgent'));
    html += `</div>`;
  }

  if (today.length) {
    html += `<div class="urgency-section">
      <div class="urgency-label" style="color:var(--orange)">üü° Esta semana</div>`;
    today.forEach(r => html += leadCard(r, 'today'));
    html += `</div>`;
  }

  if (ok.length) {
    html += `<div class="urgency-section">
      <div class="urgency-label" style="color:var(--muted)">üü¢ Al d√≠a</div>`;
    ok.forEach(r => html += leadCard(r, 'ok'));
    html += `</div>`;
  }

  if (sin.length) {
    html += `<div class="urgency-section">
      <div class="urgency-label" style="color:var(--muted)">Sin sem√°foro</div>`;
    sin.forEach(r => html += leadCard(r, 'ok'));
    html += `</div>`;
  }

  if (!html) html = `<div class="empty"><div class="empty-icon">üéâ</div><div class="empty-msg">No hay leads cargados a√∫n</div></div>`;
  container.innerHTML = html;
}

function leadCard(r, cls) {
  const empresa = r[0]||'';
  const contacto = r[1]||'';
  const wpp = r[3]||'';
  const mail = r[4]||'';
  const medio = r[5]||'';
  const estado = r[8]||'';
  const paso = r[11]||r[6]||'';
  const fecha = r[9]||'';

  const hasWpp = wpp && wpp.trim() && wpp !== 'nan';
  const hasMail = mail && mail.trim() && mail !== 'nan';
  const canal = hasWpp ? 'üí¨ WhatsApp' : hasMail ? 'üìß Email' : 'üíº LinkedIn';
  const canalColor = hasWpp ? 'var(--green)' : hasMail ? 'var(--gold)' : 'var(--blue)';

  const leadJson = encodeURIComponent(JSON.stringify({empresa,contacto,wpp,mail,medio,estado,paso,fecha}));

  return `<div class="lead-card ${cls}" onclick="openMensajeModal(decodeURIComponent('${leadJson}'))">
    <div>
      <div class="lc-empresa">${empresa}</div>
      <div class="lc-contacto">${contacto} ¬∑ <span style="color:var(--muted);font-size:11px">${medio}</span></div>
      ${paso ? `<div class="lc-paso">${paso}</div>` : ''}
      <div style="display:flex;align-items:center;gap:8px;margin-top:6px">
        <span style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:${canalColor}">${canal}</span>
        ${fecha ? `<span class="prox-fecha">¬∑ ${fecha.split(' ')[0]}</span>` : ''}
      </div>
    </div>
    <div class="lc-actions">
      ${estadoChip(estado)}
    </div>
  </div>`;
}

function estadoChip(e) {
  if (!e) return '<span class="chip chip-muted">‚Äî</span>';
  if (e.includes('Tratativa')) return `<span class="chip chip-green">ü§ù Tratativa</span>`;
  if (e.includes('Enviado')) return `<span class="chip chip-gold">‚úâÔ∏è Enviado</span>`;
  if (e.includes('Nuevo')) return `<span class="chip chip-blue">üÜï Nuevo</span>`;
  if (e.includes('Pausa')) return `<span class="chip chip-muted">‚è∏ Pausa</span>`;
  return `<span class="chip chip-muted">${e}</span>`;
}

// ‚îÄ‚îÄ RENDER LEADS TABLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderLeads() {
  const tbody = document.getElementById('leadsBody');
  if (!sheetData.leads.length) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:32px;color:var(--muted)">Sin leads cargados</td></tr>';
    return;
  }
  tbody.innerHTML = sheetData.leads.map(r => {
    const wpp = r[3]||'';
    const mail = r[4]||'';
    const hasWpp = wpp && wpp !== 'nan';
    const hasMail = mail && mail !== 'nan';
    const leadJson = encodeURIComponent(JSON.stringify({
      empresa:r[0],contacto:r[1],wpp:r[3],mail:r[4],medio:r[5],estado:r[8],paso:r[11]||r[6],fecha:r[9]
    }));
    return `<tr>
      <td>
        <div class="lead-empresa">${r[0]||''}</div>
        <div class="lead-contacto">${r[1]||''}</div>
      </td>
      <td>
        <div style="display:flex;flex-direction:column;gap:4px">
          ${hasWpp ? `<span style="font-size:11px;color:var(--green)">üí¨ ${wpp}</span>` : ''}
          ${hasMail ? `<span style="font-size:11px;color:var(--gold)">üìß ${mail}</span>` : ''}
          ${!hasWpp && !hasMail ? `<span style="font-size:11px;color:var(--muted)">Solo LinkedIn</span>` : ''}
        </div>
      </td>
      <td>${estadoChip(r[8]||'')}</td>
      <td>${r[10]||'‚Äî'}</td>
      <td><div class="paso-text">${r[11]||r[6]||'‚Äî'}</div>
        ${r[9] ? `<div class="prox-fecha">${(r[9]+'').split(' ')[0]}</div>` : ''}
      </td>
      <td><button class="btn btn-ghost btn-sm" onclick="openMensajeModal(decodeURIComponent('${leadJson}'))">‚úâÔ∏è Mensaje</button></td>
    </tr>`;
  }).join('');
}

// ‚îÄ‚îÄ RENDER VISTAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderVistage() {
  const tbody = document.getElementById('vistageBody');
  if (!sheetData.vistage.length) {
    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:32px;color:var(--muted)">Sin datos de Vistage cargados en el Sheets</td></tr>';
    return;
  }
  tbody.innerHTML = sheetData.vistage.map(r => `<tr>
    <td>
      <div class="lead-empresa">${r[2]||''}</div>
      <div class="lead-contacto">${r[0]||''}</div>
    </td>
    <td><span style="font-size:12px;color:var(--muted)">${r[4]||'‚Äî'}</span></td>
    <td>${estadoChip(r[5]||'')}</td>
    <td><span style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--muted)">${(r[6]||'').split(' ')[0]||'‚Äî'}</span></td>
    <td><button class="btn btn-ghost btn-sm" onclick="moverALeads('${encodeURIComponent(r[2]||'')}','${encodeURIComponent(r[0]||'')}','${encodeURIComponent(r[4]||'')}')">‚Üí A Leads</button></td>
  </tr>`).join('');
}

// ‚îÄ‚îÄ POPULATE SELECTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function populateRespSelect() {
  const sel = document.getElementById('respLead');
  const opts = sheetData.leads.map(r =>
    `<option value="${encodeURIComponent(JSON.stringify({empresa:r[0],contacto:r[1],wpp:r[3],mail:r[4],paso:r[11]||r[6]}))}">${r[0]} ‚Äî ${r[1]}</option>`
  ).join('');
  sel.innerHTML = '<option value="">‚Äî Seleccion√° el lead ‚Äî</option>' + opts;
}

// ‚îÄ‚îÄ PLAN DEL D√çA IA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function generarPlanDia() {
  const leads = sheetData.leads;
  if (!leads.length) { showNotify('Carg√° la planilla primero', 'error'); return; }

  const resumen = leads.map(r => {
    const wpp = r[3]&&r[3]!=='nan' ? `WPP: ${r[3]}` : '';
    const mail = r[4]&&r[4]!=='nan' ? `Mail: ${r[4]}` : '';
    const contacto = wpp || mail || 'Solo LinkedIn';
    return `‚Ä¢ ${r[0]} / ${r[1]} | ${r[5]||''} | ${r[8]||''} | ${r[10]||'sin sem√°foro'} | ${contacto} | ${r[11]||r[6]||''}`;
  }).join('\n');

  const prompt = `${ENFOCO_CTX}

HOY ES: ${new Date().toLocaleDateString('es-AR', {weekday:'long',day:'numeric',month:'long'})}

LEADS ACTUALES:
${resumen}

Dame el plan del d√≠a:
1. Los 3-5 leads que hay que tocar HOY en orden de prioridad
2. Para cada uno: por qu√© medio (WPP/LinkedIn/Mail) y por qu√©
3. Una l√≠nea de qu√© decirle a cada uno

S√© directo y concreto. Sin intro larga.`;

  document.getElementById('loaderHoy').classList.add('on');
  document.getElementById('planResult').style.display = 'none';

  try {
    const r = await callClaude(prompt);
    document.getElementById('planBody').textContent = r;
    document.getElementById('planResult').style.display = 'block';
  } catch(e) { showNotify('Error IA: ' + e.message, 'error'); }
  finally { document.getElementById('loaderHoy').classList.remove('on'); }
}

// ‚îÄ‚îÄ MODAL MENSAJE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openMensajeModal(leadJson) {
  currentLead = JSON.parse(leadJson);
  document.getElementById('modalMensajeTitulo').textContent =
    `Mensaje para ${currentLead.empresa}`;
  document.getElementById('msgResult').style.display = 'none';
  document.getElementById('msgAccion').style.display = 'none';
  document.getElementById('msg_contexto').value = '';

  // Auto-seleccionar canal seg√∫n datos disponibles
  if (currentLead.wpp && currentLead.wpp !== 'nan') selectCanal('wpp', document.querySelector('.canal-opt.wpp'));
  else if (currentLead.mail && currentLead.mail !== 'nan') selectCanal('mail', document.querySelector('.canal-opt.mail'));
  else selectCanal('li', document.querySelector('.canal-opt.li'));

  openModal('modalMensaje');
}

async function generarMensaje() {
  if (!currentLead) return;

  const tipo = document.getElementById('msg_tipo').value;
  const ctx  = document.getElementById('msg_contexto').value;
  const canalNombre = selectedCanal === 'wpp' ? 'WhatsApp' : selectedCanal === 'li' ? 'LinkedIn' : 'Email';

  const prompt = `${ENFOCO_CTX}

Generame un mensaje de ${canalNombre} para:
- Empresa: ${currentLead.empresa}
- Contacto: ${currentLead.contacto}
- Tipo: ${tipo}
- Contexto previo: ${currentLead.paso||'sin historial'}
- Info adicional: ${ctx||'ninguna'}
${currentLead.wpp && currentLead.wpp!=='nan' ? `- Tiene WhatsApp: ${currentLead.wpp}` : ''}
${currentLead.mail && currentLead.mail!=='nan' ? `- Tiene email: ${currentLead.mail}` : '- Sin contacto directo, solo LinkedIn'}

Escrib√≠ SOLO el mensaje, listo para copiar y pegar. Sin comillas ni explicaciones.${canalNombre==='Email' ? ' Inclu√≠ asunto en la primera l√≠nea.' : ''}`;

  document.getElementById('loaderMsg').classList.add('on');
  document.getElementById('msgResult').style.display = 'none';
  document.getElementById('msgAccion').style.display = 'none';

  try {
    const r = await callClaude(prompt);
    document.getElementById('msgBody').textContent = r;
    document.getElementById('msgResult').style.display = 'block';
    document.getElementById('msgAccion').style.display = 'block';
  } catch(e) { showNotify('Error: ' + e.message, 'error'); }
  finally { document.getElementById('loaderMsg').classList.remove('on'); }
}

function confirmarEnvioMsg() {
  const dias = parseInt(document.getElementById('msgDias').value);
  const nueva = new Date();
  nueva.setDate(nueva.getDate() + dias);
  showNotify(`‚úì Registrado. Pr√≥ximo seguimiento: ${nueva.toLocaleDateString('es-AR')}`, 'success');
  document.getElementById('msgAccion').style.display = 'none';
  closeModal('modalMensaje');
}

// ‚îÄ‚îÄ ANALIZAR LINKEDIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function analizarLinkedIn() {
  const url = document.getElementById('liUrl').value.trim();
  const rubro = document.getElementById('liRubro').value.trim();
  if (!url) { showNotify('Ingres√° la URL', 'error'); return; }

  const prompt = `${ENFOCO_CTX}

Me pasaron este perfil de LinkedIn para prospectar: ${url}
Rubro aproximado: ${rubro||'desconocido'}

Bas√°ndote en la URL (extrae el nombre del slug si pod√©s) y el rubro:
1. Suger√≠ nombre probable, empresa probable, cargo probable
2. Gener√° un mensaje de primer contacto de LinkedIn listo para enviar
3. Devolv√© en este formato exacto:
NOMBRE: [nombre]
EMPRESA: [empresa]
CARGO: [cargo]
RUBRO: [rubro]
MENSAJE:
[el mensaje]`;

  await procesarAnalisisLi(prompt, url);
}

async function analizarTextoLinkedIn() {
  const texto = document.getElementById('liTexto').value.trim();
  const rubro = document.getElementById('liRubro2').value.trim();
  if (!texto) { showNotify('Peg√° el texto del perfil', 'error'); return; }

  const prompt = `${ENFOCO_CTX}

Me pasaron esta info de un perfil de LinkedIn:
${texto}
Rubro adicional: ${rubro||''}

1. Extra√©: nombre, empresa, cargo, rubro
2. Gener√° un mensaje de primer contacto de LinkedIn personalizado bas√°ndote en los datos
3. Devolv√© en este formato exacto:
NOMBRE: [nombre]
EMPRESA: [empresa]
CARGO: [cargo]
RUBRO: [rubro]
MENSAJE:
[el mensaje]`;

  await procesarAnalisisLi(prompt, '');
}

async function procesarAnalisisLi(prompt, url) {
  document.getElementById('loaderLi').classList.add('on');
  document.getElementById('liResult').style.display = 'none';
  document.getElementById('liFormContainer').style.display = 'none';

  try {
    const r = await callClaude(prompt);
    document.getElementById('liBody').textContent = r;
    document.getElementById('liResult').style.display = 'block';

    // Parsear respuesta
    const nombre  = (r.match(/NOMBRE:\s*(.+)/i)||[])[1]?.trim()||'';
    const empresa = (r.match(/EMPRESA:\s*(.+)/i)||[])[1]?.trim()||'';
    const cargo   = (r.match(/CARGO:\s*(.+)/i)||[])[1]?.trim()||'';
    const rubro   = (r.match(/RUBRO:\s*(.+)/i)||[])[1]?.trim()||'';
    const msgMatch = r.match(/MENSAJE:\s*([\s\S]+)/i);
    const msg = msgMatch ? msgMatch[1].trim() : '';

    document.getElementById('vi_nombre').value  = nombre;
    document.getElementById('vi_company').value = empresa;
    document.getElementById('vi_cargo').value   = cargo;
    document.getElementById('vi_rubro').value   = rubro;
    document.getElementById('vi_url').value     = url || '';
    document.getElementById('vi_msg').value     = msg;
    document.getElementById('liFormContainer').style.display = 'block';
  } catch(e) { showNotify('Error: ' + e.message, 'error'); }
  finally { document.getElementById('loaderLi').classList.remove('on'); }
}

function guardarVistage() {
  const nombre  = document.getElementById('vi_nombre').value;
  const empresa = document.getElementById('vi_company').value;
  if (!nombre && !empresa) { showNotify('Complet√° al menos nombre o empresa', 'error'); return; }

  // Agregar a datos locales
  const entry = [empresa,'',nombre,document.getElementById('vi_url').value,
    document.getElementById('vi_rubro').value,'0 - Enviado Linkedin',
    new Date().toLocaleDateString('es-AR'),'','',document.getElementById('vi_msg').value,''];
  sheetData.vistage.unshift(entry);
  renderVistage();
  showNotify(`‚úì ${nombre} guardado en Vistage 2026`, 'success');

  // Limpiar
  ['vi_nombre','vi_company','vi_cargo','vi_rubro','vi_url','vi_prov','vi_msg'].forEach(id =>
    document.getElementById(id).value = '');
  document.getElementById('liResult').style.display = 'none';
  document.getElementById('liFormContainer').style.display = 'none';
  document.getElementById('liUrl').value = '';
  document.getElementById('liTexto').value = '';
}

// ‚îÄ‚îÄ PROCESAR RESPUESTA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function procesarRespuesta() {
  const leadSel = document.getElementById('respLead').value;
  const texto   = document.getElementById('respTexto').value.trim();
  if (!leadSel || !texto) { showNotify('Seleccion√° el lead y peg√° la respuesta', 'error'); return; }

  const lead = JSON.parse(decodeURIComponent(leadSel));
  const wpp  = document.getElementById('respWpp').value.trim() || lead.wpp;
  const mail = document.getElementById('respMail').value.trim() || lead.mail;
  const hasWpp  = wpp && wpp !== 'nan';
  const hasMail = mail && mail !== 'nan';
  const canal   = hasWpp ? 'WhatsApp' : hasMail ? 'Email' : 'LinkedIn';

  const prompt = `${ENFOCO_CTX}

LEAD: ${lead.empresa} / ${lead.contacto}
HISTORIAL PREVIO: ${lead.paso||'sin historial'}
${hasWpp ? `TIENE WHATSAPP: ${wpp}` : hasMail ? `TIENE EMAIL: ${mail}` : 'SOLO LINKEDIN'}

ME RESPONDI√ì ESTO:
"${texto}"

Hac√© 3 cosas:
1. RESUMEN (2 l√≠neas): qu√© dijo y c√≥mo est√° la conversaci√≥n
2. PR√ìXIMO PASO: qu√© recomendar hacer ahora
3. MENSAJE (listo para copiar por ${canal}): la respuesta ideal

Formato:
RESUMEN:
[resumen]

PR√ìXIMO PASO:
[recomendaci√≥n]

MENSAJE POR ${canal.toUpperCase()}:
[mensaje]`;

  document.getElementById('loaderResp').classList.add('on');
  document.getElementById('respResult').style.display = 'none';
  document.getElementById('respAccion').style.display = 'none';

  try {
    const r = await callClaude(prompt);
    document.getElementById('respBody').textContent = r;
    document.getElementById('respResult').style.display = 'block';
    document.getElementById('respAccion').style.display = 'block';

    // Si respondi√≥ ‚Üí mover a leads si ven√≠a de vistage
    const origen = document.getElementById('respOrigen').value;
    if (origen === 'vistage') {
      showNotify(`${lead.empresa} deber√≠a moverse a Leads 2026`, 'success');
    }
  } catch(e) { showNotify('Error: ' + e.message, 'error'); }
  finally { document.getElementById('loaderResp').classList.remove('on'); }
}

function confirmarEnvio() {
  const dias = parseInt(document.getElementById('respDias').value);
  const nueva = new Date();
  nueva.setDate(nueva.getDate() + dias);
  showNotify(`‚úì Pr√≥ximo seguimiento: ${nueva.toLocaleDateString('es-AR')}`, 'success');
  document.getElementById('respAccion').style.display = 'none';
}

function moverALeads(empresa, nombre, rubro) {
  showPanel('respuesta', document.querySelector('.nav-item:nth-child(6)'));
  document.getElementById('respOrigen').value = 'vistage';
  showNotify(`Registr√° la respuesta de ${decodeURIComponent(nombre)} para moverlo a Leads`, 'success');
}

// ‚îÄ‚îÄ GUARDAR LEAD MANUAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function guardarLead() {
  const empresa = document.getElementById('nl_empresa').value;
  if (!empresa) { showNotify('Complet√° al menos la empresa', 'error'); return; }
  const entry = [
    empresa,
    document.getElementById('nl_contacto').value,
    document.getElementById('nl_cargo').value,
    document.getElementById('nl_wpp').value,
    document.getElementById('nl_mail').value,
    document.getElementById('nl_origen').value,
    document.getElementById('nl_rubro').value,
    '',
    document.getElementById('nl_estado').value,
    '',
    'üü° Hoy',
    document.getElementById('nl_paso').value,
  ];
  sheetData.leads.unshift(entry);
  renderHoy();
  renderLeads();
  populateRespSelect();
  closeModal('modalLead');
  showNotify(`‚úì ${empresa} agregado a Leads 2026`, 'success');
  ['nl_empresa','nl_contacto','nl_cargo','nl_wpp','nl_mail','nl_paso'].forEach(id =>
    document.getElementById(id).value = '');
}

// ‚îÄ‚îÄ CLAUDE API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function callClaude(prompt) {
  const res = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': API_KEY,
      'anthropic-version': '2023-06-01'
    },
    body: JSON.stringify({
      model: 'claude-sonnet-4-6',
      max_tokens: 1000,
      messages: [{ role: 'user', content: prompt }]
    })
  });
  if (!res.ok) {
    const e = await res.json();
    throw new Error(e.error?.message || 'Error API');
  }
  const d = await res.json();
  return d.content[0].text;
}

// ‚îÄ‚îÄ UI HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showPanel(name, btn) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  if (btn) btn.classList.add('active');
  const titles = {
    hoy: 'Plan del <em>D√≠a</em>',
    leads: '<em>Leads</em> 2026',
    vistage: '<em>Vistage</em> 2026',
    nuevo_vistage: 'Cargar desde <em>LinkedIn</em>',
    respuesta: 'Registrar <em>Respuesta</em>'
  };
  document.getElementById('pageTitle').innerHTML = titles[name] || name;
}

function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

function selectCanal(c, el) {
  selectedCanal = c;
  document.querySelectorAll('.canal-opt').forEach(b => b.classList.remove('active'));
  if (el) el.classList.add('active');
}

function switchTab(id, btn) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}

function copyText(id) {
  const text = document.getElementById(id).textContent;
  navigator.clipboard.writeText(text).then(() => {
    showNotify('‚úì Copiado al portapapeles', 'success');
  });
}

function showNotify(msg, type='success') {
  const n = document.getElementById('notify');
  n.textContent = msg;
  n.className = `notify show ${type}`;
  setTimeout(() => n.classList.remove('show'), 3000);
}

// Close modal on overlay click
document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.classList.remove('open'); });
});

// ‚îÄ‚îÄ START ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.onload = checkSetup;
</script>
</body>
</html>
